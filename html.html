<!-- Correctly self-closing link tag for HTML resources -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
<div style="max-width: 1100px; margin: 0 auto; padding: 20px; background-color: #f4f4f4; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
    <h1 style="text-align: center; color: #333; font-size: 28px;">GPT4o + SNOW</h1>
<div class="alert alert-dismissible alert-primary" style="margin-top: 10px; border-radius: 5px; box-shadow: 0 0 5px rgba(0,0,0,0.1);">
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    <strong>What we're seeing:</strong> This demo features real-time interaction with OpenAI-GPT4o through ServiceNow REST API/Script Includes and UI-page elements. Give it a go below...
</div>
    <div class="chat-and-json-container" style="display: flex; flex-direction: row; justify-content: space-between; flex-wrap: wrap; margin-top: 10px;">
        <div class="chat-container" style="display: flex; flex-direction: column; flex-grow: 2; margin-right: 10px; min-width: 300px; flex-basis: 60%;">
            <div id="conversation_display" style="flex-grow: 1; max-height: 400px; overflow-y: auto; min-height: 200px; border: 1px solid #ddd; padding: 10px; background-color: #fff; border-radius: 5px; margin-bottom: 10px;">
                <!-- Messages will be dynamically added here -->
            </div>
            <textarea id="user_input" placeholder="Type your message..." rows="3" style="flex-shrink: 0; width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ddd; margin-bottom: 10px; resize: none;"></textarea>
            <button id="submit_button" onclick="sendMessage()" style="flex-shrink: 0; width: 100%; background-color: #4CAF50; color: white; padding: 10px; border: none; border-radius: 5px; cursor: pointer; font-size: 18px; position: relative;">
                <span id="button_text">Chat with GPT!</span>
                <span class="spinner" style="display: none; position: absolute; right: 10px; top: 50%; transform: translateY(-50%); border: 2px solid white; border-top: 2px solid #4CAF50; border-radius: 50%; width: 12px; height: 12px; animation: spin 1s linear infinite;"></span>
            </button>
<div id="token_and_time_container" style="display: flex; justify-content: space-between; margin-top: 10px;">
    <div id="token_count_display" style="text-align: center; font-size: 12px; color: #555; background-color: #e8e8e8; padding: 5px; border-radius: 5px;">
        <strong>Total Tokens Used: </strong><span id="token_count">0</span>
    </div>
    <div id="cost_display" style="text-align: center; font-size: 12px; color: #555; background-color: #e8e8e8; padding: 5px; border-radius: 5px;">
        <strong>Running cost: </strong><span id="estimated_cost">$0.00</span> <!-- Initialize at $0.00 -->
    </div>
    <div id="response_time_display" style="text-align: center; font-size: 12px; color: #555; background-color: #e8e8e8; padding: 5px; border-radius: 5px;">
        <strong>Avg Response Time: </strong><span id="avg_response_time">0</span>s
    </div>
</div>
        </div>

        <div class="accordion json-section" id="responseConsoleAccordion" style="flex-grow: 1; min-width: 200px; flex-basis: 38%;">
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingResponseConsole">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseResponseConsole" aria-expanded="true" aria-controls="collapseResponseConsole">
                        OpenAI Response Console
                    </button>
                </h2>
                <div id="collapseResponseConsole" class="accordion-collapse collapse show" aria-labelledby="headingResponseConsole" data-bs-parent="#responseConsoleAccordion">
                    <div id="full_json_display" class="accordion-body json-display" style="border: 1px solid #444; padding: 10px; background-color: #000; border-radius: 5px; overflow-y: auto; min-height: 150px; max-height: 500px; width: 100%; color: #ffeb3b; font-family: 'Courier New', Courier, monospace;">
                        <!-- JSON response will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Start of Accordion for Nerdy Details -->
    <div class="accordion my-3" id="nerdyDetailsAccordion" style="background-color: #f0f0f0; border-radius: 5px; border: 1px solid #ccc; font-size: 12px; color: #333;">
        <div class="accordion-item" style="border: none;">
            <h2 class="accordion-header" id="headingNerdyDetails">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseNerdyDetails" aria-expanded="false" aria-controls="collapseNerdyDetails" style="background-color: #e0e0e0; border-radius: 5px;">
                    Nerdy Details...
                </button>
            </h2>
<div id="collapseNerdyDetails" class="accordion-collapse collapse show" aria-labelledby="headingNerdyDetails" data-bs-parent="#nerdyDetailsAccordion">
                <div class="accordion-body">
                    <p>This integration leverages ServiceNow’s UI framework to create a robust interaction platform with OpenAI’s GPT-4. Below is a detailed breakdown of each component used:</p>

                    <ol>
                        <li>
                            <strong>UI Page Element:</strong>
                            <ul>
                                <li>Constructed using HTML to form the basic structure of the chat interface, allowing user input and displaying conversation threads responsively.</li>
                                <li>Utilizes embedded CSS styles for aesthetics and layout management, including flexbox for adaptable layouts on different device sizes.</li>
                            </ul>
                        </li>
                        <li>
                            <strong>Client Script:</strong>
                            <ul>
                                <li>JavaScript functions facilitate user interaction, such as <code>addUserMessage</code> to display user inputs and <code>sendMessage</code> to handle communication.</li>
                                <li>Implements event listeners on key events to capture user actions, initiating conversations with GPT-4 via asynchronous Ajax requests.</li>
                                <li>Processes and formats JSON responses, dynamically updating the chat UI to reflect real-time exchanges.</li>
                            </ul>
                        </li>
                        <li>
                            <strong>Script Include (<code>ChatGPT_via_REST</code>):</strong>
                            <ul>
                                <li>Manages server-side operations to process chatbot conversations. Utilizes ServiceNow’s server-side API, extending <code>AbstractAjaxProcessor</code> for efficient asynchronous handling.</li>
                                <li>Handles the construction and dispatch of REST API requests to the OpenAI interface, parsing the conversation history and generating appropriate JSON payloads.</li>
                                <li>Embedded error handling ensures robust interaction with external APIs, logging information into ServiceNow for operational transparency.</li>
                            </ul>
                        </li>
                        <li>
                            <strong>REST API Configuration:</strong>
                            <ul>
                                <li>Configured as a REST Message within ServiceNow to define endpoint communication details, using HTTP POST methods for interaction.</li>
                                <li>Handles authentication to OpenAI chat.completions endpoint securing interactions with the OpenAI API.</li>
                                <li>Supports dynamic variable substitution within request bodies, allowing flexible data management for outbound requests.</li>
                            </ul>
                        </li>
                    </ol>

                    <p>This comprehensive integration underscores ServiceNow’s extensible development environment by demonstrating the coupling of its UI, scripting, and API calls to Openai.</p>
                </div>
            </div>
        </div>
    </div>
    <!-- End of Accordion -->
<style>
    /* Existing styles (no changes needed to this part) */
    .chat-and-json-container {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        flex-wrap: wrap;
    }

    .chat-container {
        flex-grow: 2;
        margin-right: 10px;
        min-width: 300px;
        flex-basis: 60%;
    }

    .json-section {
        flex-grow: 1;
        min-width: 200px;
        flex-basis: 38%;
    }

    .json-display {
        font-size: 12px;
        white-space: pre-wrap;
        word-wrap: break-word;
        background-color: #000;
        color: #ffeb3b;         
        font-family: 'Courier New', Courier, monospace;
    }

    @media (max-width: 768px) {
        .chat-and-json-container {
            flex-direction: column;
        }

        .json-section, .chat-container {
            flex-basis: 100%;
            min-width: unset;
            margin-right: 0;
        }

        .json-display {
            width: 100%;
            height: auto;
            margin-top: 10px;
        }
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Adjusted font size for message bubbles */
    .user-message-bubble,
    .bot-message-bubble {
        max-width: 80%;
        padding: 10px;
        margin: 5px;
        border-radius: 15px;
        font-size: 14px; /* Smaller font size for chat messages */
    }

    .user-message-bubble {
        background-color: #DCF8C6;
        align-self: flex-end;
        text-align: right;
    }

    .bot-message-bubble {
        background-color: #007AFF;
        color: #fff;
        align-self: flex-start;
        text-align: left;
    }

    #conversation_display {
        display: flex;
        flex-direction: column;
    }

    @keyframes blink {
        0% { opacity: 1; }
        50% { opacity: 0; }
        100% { opacity: 1; }
    }

    .dot {
        display: inline-block;
        width: 8px;
        height: 8px;
        margin-left: 2px;
        background-color: #007AFF;
        border-radius: 50%;
        animation: blink 1s infinite;
        animation-delay: calc(0.1s * var(--i));
    }

    .dot:nth-child(1) { --i: 1; }
    .dot:nth-child(2) { --i: 2; }
    .dot:nth-child(3) { --i: 3; }

    h1 {
        font-size: 28px; /* Larger font size for the heading */
        text-align: center;
        margin-bottom: 10px;
    }

    h2, 
    #info_box, 
    #token_and_time_container, 
    textarea, 
    button {
        font-size: 16px; /* Adjust as necessary */
    }

    #submit_button {
        font-size: 18px; /* Adjust button font size */
    }

    .accordion-button {
        font-size: 16px; /* Adjust to make the font size larger for the Nerdy Details button */
    }

</style>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>